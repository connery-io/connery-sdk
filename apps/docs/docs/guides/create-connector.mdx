import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

# Create connector

This guide will teach you how to create a new connector using a browser-based development environment provided by GitHub Codespaces.
However, you can use any other development environment. The steps are the same.

### 1. Create a new public GitHub repository

The repository will be used to store the connector code and configuration.

---

TODO:

Steps:

- Create a new repository.
- Name repository with the name of your future connector. We recommend using the snake case naming convention.
  For example: `my-connector` repository name for `My Connector` connector.
- Make the repository public.
- Select "Add a README file" option to initialize the repository with a README file and create a new branch.
  Please make sure the branch name is `main` as it is used across the docs.
- Create a new branch for the connector development. We recommend using the `main` branch as the default branch.
  If the new branch is master, make sure you use the `master` branch name across the docs instead of main

---

The connector will have an identification key that consists of your GitHub username, repository name, and branch name.
For example: `<username>/<repository-name>@main`.

:::tip

We sincerely encourage making connectors public and open-source under the MIT license
to make them available to the community and grow the [connector ecosystem](/docs/introduction/connector-ecosystem) together :heart:

:::

### 2. Create a new GitHub Codespace for the repository

The Codespace will be used as a development environment for the connector.
This is the easiest way to develop the connector without installing software on your machine.

Once the Codespace is created and loaded, you should see a VS Code editor in your browser with a "Terminal" tab open.

:::info

The Codespace is [free of charge for 120 hours per month](https://docs.github.com/en/billing/managing-billing-for-github-codespaces/about-billing-for-github-codespaces#monthly-included-storage-and-core-hours-for-personal-accounts) for personal accounts.

GitHub Codespace will stop running after a period of inactivity to safe resources.
[By default this period is 30 minutes.](https://docs.github.com/en/codespaces/customizing-your-codespace/setting-your-timeout-period-for-github-codespaces?tool=webui#about-the-idle-timeout)
So don't forget to save your work before you leave the Codespace.

:::

<details>
  <summary>Hints</summary>

- If you are not familiar with GitHub Codespaces, you can follow the
  [Create a GitHub Codespace for arepository](https://docs.github.com/en/codespaces/developing-in-codespaces/creating-a-codespace-for-a-repository?tool=webui)
  guide.
- If you prefer to use another development environment, you can skip this
  step, clone the repository, open it in your favorite IDE, and continue with
  the next steps. In this case, make sure you have the latest version of Node.js installed.

</details>

### 3. Initialize the connector repository

To make it very easy to start with the connector development, we created a tool to initialize the connector repository for you.
After you answer a couple of questions, the tool will generate all the files needed for the connector development in your repository.

Run the following command in the terminal and follow the instructions.
This command will install the latest version of Connery CLI and run the initialization process.

```
npx connery@latest init
```

Once the initialization is finished, you should see the new files added to the repository.
The newly initialized connector is fully functional.
The entry point of the connector is the `./index.js` file.
It contains the connector definition and a sample action defined in the `./actions/sample-action.js` file.
The sample action sums up two numbers and returns the result.
This is a good starting point for exploring and experimenting with the connector.
You can remove the sample action when you don't need it.

### 4. Install dependencies

To continue with the connector development, you need to install all the dependencies of the connector:

```
npm install
```

### 5. Add a new action to the connector

And now, the fun part starts - creating your first action in the connector.
To add a new empty action, use the following command from Connery CLI:

```
npx connery@latest add-action
```

You will be asked a couple of questions about the action you want to add.
After all the necessary information is provided, Connery CLI will add the action to the connector
by making a couple of changes to the files of your repository:

- A new action file will be added to the `./actions` folder.
- The action will be included in the connector definition in the `./index.js` file.
- A new test file will be added to the `./test` folder.

Now, you can implement the logic of the action. Open the action definition file `./actions/<action-name>.js`,
define input and output parameters of the action and implement the logic of the action in the `handler` function.

:::note Helpful resources

- Use the sample action as an example.
- Check the [connector definition schema](https://github.com/connery-io/connery/blob/main/packages/lib/src/connector.schema.ts)
  to understand how the definition of the connector and action works.
- Use the [existing open-source connectors](/docs/connectors) as an inspiration and example.

:::

---

### 6. Test action

how to test the action during development

```
npx connery@latest run-action
```

For advanced user: you can also test the action using uni tests. See more details in the advanced section.

---

TODO:

- mention shortcut produced by CLI to run the action faster with the same paramnters next time
- Add gif

---

### 7. Build connector

```
npm run build
```

The build process:

- run tests
- validate connector definition
- build connector and dependencies in the way the runner can use

Build sources should be stored in the repository in the `./build` folder so the runner can use them immediately without the need to build the connector again.

### 8. Commit and push the files

Run the following command in the terminal to commit and push the files to GitHub.

```
git add . && git commit -m "Init connector repository" && git push origin main
```

:::caution
Please make sure you delete all the secrets you used during testing before pushing the changes to the repository
:::

### Next steps

2. [Install the connector on the runner.](/docs/getting-started/install-connector-on-the-runner)
3. [Use clients](/docs/getting-started/use-clients-to-call-actions) to run actions from the connector.

---

TODO:

- Mention that the user can use any NPM pachages.
- Ask user to crete repo with the branch name 'main', not `master` as it the main branch name is used across the docs.
